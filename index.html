<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WuHu</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f0f0f0;
    }

    .image-container {
      position: relative;
    }

    #imageA {
      display: block;
      max-width: 100%;
      height: auto;
      position: relative;
      z-index: 1;
    }

    #imageB {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 0.1s ease-out;
      pointer-events: none;
      z-index: 3;

      -webkit-mask-image: radial-gradient(circle, black var(--reveal-radius), transparent calc(var(--reveal-radius) + 1px));
      -webkit-mask-size: calc(var(--reveal-radius) * 2) calc(var(--reveal-radius) * 2);
      -webkit-mask-repeat: no-repeat;

      mask-image: radial-gradient(circle, black var(--reveal-radius), transparent calc(var(--reveal-radius) + 1px));
      mask-size: calc(var(--reveal-radius) * 2) calc(var(--reveal-radius) * 2);
      mask-repeat: no-repeat;
    }

    #darkenOverlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      opacity: 0;
      z-index: 4;
      transition: opacity 0.2s linear;
      pointer-events: none;

      -webkit-mask-image: radial-gradient(circle at var(--mouse-x) var(--mouse-y), transparent var(--reveal-radius), black calc(var(--reveal-radius) + 1px));
      -webkit-mask-repeat: no-repeat;
      -webkit-mask-size: 100% 100%;

      mask-image: radial-gradient(circle at var(--mouse-x) var(--mouse-y), transparent var(--reveal-radius), black calc(var(--reveal-radius) + 1px));
      mask-repeat: no-repeat;
      mask-size: 100% 100%;
    }

    /* 新增覆盖层，固定显示2015图片，鼠标离开时显示 */
    #overlayImage {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      z-index: 10;
      display: none; /* 初始隐藏 */
      pointer-events: none;
    }
  </style>
</head>

<body>
  <div class="image-container">
    <img id="imageA" src="https://i2.hdslb.com/bfs/new_dyn/1115c37f96a319b71f35f3f4f09a37a041008385.png" alt="主图片A" />
    <img id="imageB" src="https://i2.hdslb.com/bfs/new_dyn/28b355aaf360107bb9d2afce5d2b5c9541008385.png" alt="揭示图片B" />
    <div id="darkenOverlay"></div>
    <img id="overlayImage" src="https://i2.hdslb.com/bfs/new_dyn/1115c37f96a319b71f35f3f4f09a37a041008385.png" alt="覆盖2015" />
  </div>

  <script>
    const imageContainer = document.querySelector('.image-container');
    const imageA = document.getElementById('imageA');
    const imageB = document.getElementById('imageB');
    const darkenOverlay = document.getElementById('darkenOverlay');
    const overlayImage = document.getElementById('overlayImage');

    const revealRadius = 180;
    imageB.style.setProperty('--reveal-radius', `${revealRadius}px`);
    darkenOverlay.style.setProperty('--reveal-radius', `${revealRadius}px`);

    const setContainerSize = () => {
      if (imageA.complete) {
        imageContainer.style.width = imageA.offsetWidth + 'px';
        imageContainer.style.height = imageA.offsetHeight + 'px';
        overlayImage.style.width = imageA.offsetWidth + 'px';
        overlayImage.style.height = imageA.offsetHeight + 'px';
      }
    };
    imageA.onload = setContainerSize;
    setContainerSize();

    let lastMouseTime = Date.now();
    let fadeStartTime = null;

    imageContainer.addEventListener('mousemove', (e) => {
      const rect = imageContainer.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;

      imageB.style.webkitMaskPosition = `${mouseX - revealRadius}px ${mouseY - revealRadius}px`;
      imageB.style.maskPosition = `${mouseX - revealRadius}px ${mouseY - revealRadius}px`;

      darkenOverlay.style.setProperty('--mouse-x', `${mouseX}px`);
      darkenOverlay.style.setProperty('--mouse-y', `${mouseY}px`);

      imageB.style.opacity = 1;
      darkenOverlay.style.opacity = 0;

      overlayImage.style.display = 'none';  // 鼠标进来隐藏覆盖图

      imageB.style.pointerEvents = 'auto';
      darkenOverlay.style.pointerEvents = 'auto';

      lastMouseTime = Date.now();
      fadeStartTime = null;
    });

    imageContainer.addEventListener('mouseleave', () => {
      imageB.style.opacity = 0;
      darkenOverlay.style.opacity = 0;
      fadeStartTime = null;

      overlayImage.style.display = 'block';  // 鼠标离开显示覆盖图

      imageB.style.pointerEvents = 'none';
      darkenOverlay.style.pointerEvents = 'none';
    });

    const maxDarkenOpacity = 0.32;

    function checkIdleAndFade() {
      const now = Date.now();
      const idleTime = now - lastMouseTime;

      if (idleTime >= 500) {
        if (!fadeStartTime) fadeStartTime = now;
        const elapsed = now - fadeStartTime;
        const progress = Math.min(elapsed / 2000, 1);
        const newOpacity = maxDarkenOpacity * progress;
        darkenOverlay.style.opacity = newOpacity.toFixed(3);
      }

      requestAnimationFrame(checkIdleAndFade);
    }

    requestAnimationFrame(checkIdleAndFade);
  </script>
</body>
</html>
